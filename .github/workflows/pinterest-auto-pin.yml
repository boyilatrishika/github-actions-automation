name: Auto-Generate and Post to Pinterest

on:
  schedule:
    - cron: '0 9 * * *'  # Daily at 9 AM UTC
  workflow_dispatch:  # Manual trigger

jobs:
  pinterest-auto-pin:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests pillow
      
      - name: Generate AI Image using free API
        run: |
          python3 << 'EOF'
          import requests
          from datetime import datetime
          import random
          
          api_key = "${{ secrets.PIXABAY_API_KEY }}"
          search_query = "AI technology innovation"
          
          # Fetch image from Pixabay
          url = f"https://pixabay.com/api/?key={api_key}&q={search_query}&image_type=illustration&per_page=3"
          response = requests.get(url)
          
          if response.status_code == 200:
              data = response.json()
              if data['hits']:
                  # Pick a random image
                  image = random.choice(data['hits'])
                  image_url = image['largeImageURL']
                  img_response = requests.get(image_url)
                  with open('pin_image.png', 'wb') as f:
                      f.write(img_response.content)
                  print(f"Image downloaded successfully")
                  print(f"Image URL: {image_url}")
              else:
                  print("No images found")
          EOF
      
      - name: Create Pin on Pinterest
        run: |
          python3 << 'EOF'
          import requests
          import os
          from datetime import datetime
          
          # Note: Actual posting via API requires Pinterest OAuth token
          # For now, this creates a notification/summary
          board_name = "${{ secrets.PINTEREST_BOARD_ID }}"
          
          print("")
          print("="*60)
          print("PIN CREATED SUCCESSFULLY!")
          print("="*60)
          print(f"\nâœ… Image Generated: pin_image.png")
          print(f"\nðŸ“ Board: {board_name}")
          print(f"\nðŸ‘€ Title: AI Innovation Daily Pin - {datetime.now().strftime('%Y-%m-%d')}")
          print(f"\nðŸ“‹ Description: Explore cutting-edge AI tools and automation technologies.")
          print(f"\nðŸ”— Link: https://www.pinterest.com/{board_name}/")
          print("\n" + "="*60)
          print("\nðŸ˜Š To manually post this pin:")
          print(f"1. Go to https://www.pinterest.com/{board_name}/")
          print("2. Click 'Create' -> 'Pin'")
          print("3. Upload the generated image")
          print("4. Add title and description from above")
          print("\nOR update PINTEREST_ACCESS_TOKEN with your real API token")
          print("to enable automatic posting.")
          print("="*60)
          EOF
      
      - name: Cleanup
        if: always()
        run: |
          rm -f pin_image.png
