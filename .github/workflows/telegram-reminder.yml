name: Telegram Daily Reminder
on:
  schedule:
    # 2:30 AM UTC = 8:00 AM IST (UTC+5:30)
    - cron: '30 2 * * *'
  workflow_dispatch:

jobs:
  send-reminder:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Debug - Display current UTC and IST times
        run: |
          echo "=== Timezone Information ==="
          echo "Current UTC time: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
          echo "Current IST time: $(TZ='Asia/Kolkata' date '+%Y-%m-%d %H:%M:%S IST')"
          echo "Event: ${{ github.event_name }}"
          echo "Scheduled cron: 30 2 * * * (2:30 AM UTC = 8:00 AM IST)"

      - name: Send Telegram reminder message
        # Scheduled: always send (cron is correctly timed)
        # Manual: always send
        if: github.event_name == 'schedule' || github.event_name == 'workflow_dispatch'
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          echo "Sending Telegram reminder message (event: ${{ github.event_name }})..."
          echo "Chat ID: ${TELEGRAM_CHAT_ID}"
          RESPONSE=$(curl -sS -X POST \
            "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage" \
            -H "Content-Type: application/json" \
            -d "{
              \"chat_id\": \"${TELEGRAM_CHAT_ID}\",
              \"text\": \"☀️ Good morning! Time to start your day!\",
              \"parse_mode\": \"HTML\"
            }")
          echo "Telegram API response:"
          echo "$RESPONSE"
          if echo "$RESPONSE" | grep -q '\"ok\":false'; then
            echo "Telegram reported an error."
            exit 1
          fi
          echo "Message step completed."
